import{a as N,b as D,e as O,g as V,m as W}from"./chunk-CVTXNI7X.js";import{g as T,h as R,j,q as x,r as k,u as F}from"./chunk-DW6AFCKZ.js";import{$ as I,$a as d,Aa as o,Ab as h,Bb as b,Cb as y,Gb as C,Ib as M,Ja as w,Oa as p,Q as _,V as u,aa as S,ab as n,bb as t,cb as E,hb as A,kb as f,lb as g,vb as i,wb as m,zb as P}from"./chunk-BIY3REYI.js";var v=class a{#e=u(k);#t=F.apiBaseUrl+"/admin/inventory";list(r){let e=new x;return r&&(e=e.set("productId",r)),this.#e.get(`${this.#t}`,{params:e,withCredentials:!0})}transactions(r,e=1,l=50){let c=new x().set("page",e).set("pageSize",l);return r&&(c=c.set("productId",r)),this.#e.get(`${this.#t}/transactions`,{params:c,withCredentials:!0})}adjust(r,e,l){return this.#e.post(`${this.#t}/adjust`,{productId:r,delta:e,reason:l},{withCredentials:!0})}static \u0275fac=function(e){return new(e||a)};static \u0275prov=_({token:a,factory:a.\u0275fac,providedIn:"root"})};function B(a,r){if(a&1){let e=A();n(0,"tr")(1,"td"),i(2),t(),n(3,"td"),i(4),t(),n(5,"td"),i(6),t(),n(7,"td"),i(8),t(),n(9,"td")(10,"button",15),f("click",function(){let c=I(e).$implicit,s=g();return S(s.select(c))}),i(11,"Ver movimientos"),t()()()}if(a&2){let e=r.$implicit;o(2),m(e.sku),o(2),P("",e.brand," ",e.modelName," ",e.size),o(2),m(e.onHand),o(2),m(e.reserved)}}function U(a,r){if(a&1&&(n(0,"span"),i(1),t()),a&2){let e=g();o(),m(e.selected==null?null:e.selected.sku)}}function q(a,r){a&1&&(n(0,"span"),i(1,"(selecciona de la lista)"),t())}function L(a,r){if(a&1&&(n(0,"tr")(1,"td"),i(2),C(3,"date"),t(),n(4,"td"),i(5),t(),n(6,"td"),i(7),t(),n(8,"td"),i(9),t()()),a&2){let e=r.$implicit;o(2),m(M(3,4,e.createdAtUtc,"short")),o(3),m(e.quantity),o(2),m(e.type),o(2),m(e.reference)}}function $(a,r){if(a&1&&(n(0,"div",16)(1,"h6"),i(2,"Movimientos"),t(),n(3,"div",17)(4,"table",18)(5,"thead")(6,"tr")(7,"th"),i(8,"Fecha"),t(),n(9,"th"),i(10,"Cant"),t(),n(11,"th"),i(12,"Tipo"),t(),n(13,"th"),i(14,"Ref"),t()()(),n(15,"tbody"),p(16,L,10,7,"tr",5),t()()()()),a&2){let e=g();o(16),d("ngForOf",e.txns)}}var H=class a{#e=u(v);rows=[];txns=[];selected=null;delta=null;reason="";ngOnInit(){this.reload()}reload(){this.#e.list().subscribe({next:r=>this.rows=r,error:()=>this.rows=[]})}select(r){this.selected=r,this.#e.transactions(r.id,1,50).subscribe({next:e=>this.txns=e.items,error:()=>this.txns=[]})}adjust(){!this.selected||this.delta===null||this.#e.adjust(this.selected.id,this.delta,this.reason).subscribe({next:()=>{this.delta=null,this.reason="",this.reload(),this.selected&&this.select(this.selected)},error:()=>{}})}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=w({type:a,selectors:[["ng-component"]],decls:33,vars:9,consts:[[1,"container","my-4"],[1,"row","g-2","mb-3"],[1,"col-12","col-md-8"],[1,"table-responsive"],[1,"table","align-middle"],[4,"ngFor","ngForOf"],[1,"col-12","col-md-4"],[1,"card","p-3"],[1,"card-title"],[1,"mb-2","small","text-muted"],[4,"ngIf"],["type","number","placeholder","Delta (ej. 5 o -3)",1,"form-control","mb-2",3,"ngModelChange","ngModel","disabled"],["placeholder","Motivo",1,"form-control","mb-2",3,"ngModelChange","ngModel","disabled"],[1,"btn","btn-dark",3,"click","disabled"],["class","mt-3",4,"ngIf"],[1,"btn","btn-sm","btn-outline-secondary",3,"click"],[1,"mt-3"],[1,"table-responsive",2,"max-height","260px"],[1,"table","table-sm"]],template:function(e,l){e&1&&(n(0,"section",0)(1,"h2"),i(2,"Inventario (Admin)"),t(),n(3,"div",1)(4,"div",2)(5,"div",3)(6,"table",4)(7,"thead")(8,"tr")(9,"th"),i(10,"SKU"),t(),n(11,"th"),i(12,"Producto"),t(),n(13,"th"),i(14,"OnHand"),t(),n(15,"th"),i(16,"Reservado"),t(),E(17,"th"),t()(),n(18,"tbody"),p(19,B,12,6,"tr",5),t()()()(),n(20,"div",6)(21,"div",7)(22,"h5",8),i(23,"Ajustar inventario"),t(),n(24,"div",9),i(25,"Producto: "),p(26,U,2,1,"span",10)(27,q,2,0,"span",10),t(),n(28,"input",11),y("ngModelChange",function(s){return b(l.delta,s)||(l.delta=s),s}),t(),n(29,"input",12),y("ngModelChange",function(s){return b(l.reason,s)||(l.reason=s),s}),t(),n(30,"button",13),f("click",function(){return l.adjust()}),i(31,"Aplicar"),t()(),p(32,$,17,1,"div",14),t()()()),e&2&&(o(19),d("ngForOf",l.rows),o(7),d("ngIf",l.selected),o(),d("ngIf",!l.selected),o(),h("ngModel",l.delta),d("disabled",!l.selected),o(),h("ngModel",l.reason),d("disabled",!l.selected),o(),d("disabled",!l.selected||!l.delta),o(2),d("ngIf",l.txns.length))},dependencies:[T,R,W,N,V,D,O,j],encapsulation:2})};export{H as InventoryAdminPage};
