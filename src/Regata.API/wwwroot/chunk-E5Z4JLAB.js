import{a as D}from"./chunk-XTFK7LT5.js";import{b as H,c as U,f as z,h as q,p as G}from"./chunk-S2MMUX5V.js";import{a as M}from"./chunk-CLVRU5UC.js";import{g as L,h as N,j as O,q as F,r as b}from"./chunk-FI2SLH6F.js";import{Cb as E,Da as d,Eb as g,Fb as u,Gb as _,Lb as B,Ma as A,Nb as k,Pb as j,R as w,Ra as x,W as y,a as P,aa as c,ba as p,cb as h,db as i,eb as n,fb as T,ib as W,jb as V,kb as I,nb as v,ob as s,vb as R,yb as m,zb as f}from"./chunk-4XZ7JV2Z.js";var C=class a{#e=y(b);#t=M.apiBaseUrl+"/admin/inventory";list(l){let e=new F;return l&&(e=e.set("productId",l)),this.#e.get(`${this.#t}`,{params:e,withCredentials:!0})}transactions(l,e=1,o=50){let t=new F().set("page",e).set("pageSize",o);return l&&(t=t.set("productId",l)),this.#e.get(`${this.#t}/transactions`,{params:t,withCredentials:!0})}adjust(l,e,o){return this.#e.post(`${this.#t}/adjust`,{productId:l,delta:e,reason:o},{withCredentials:!0})}static \u0275fac=function(e){return new(e||a)};static \u0275prov=w({token:a,factory:a.\u0275fac,providedIn:"root"})};var S=class a{#e=y(b);#t=M.apiBaseUrl+"/admin/products";upsertTire(l,e){return this.#e.post(`${this.#t}/${l}/tire`,e,{withCredentials:!0})}upsertRim(l,e){return this.#e.post(`${this.#t}/${l}/rim`,e,{withCredentials:!0})}static \u0275fac=function(e){return new(e||a)};static \u0275prov=w({token:a,factory:a.\u0275fac,providedIn:"root"})};function Q(a,l){if(a&1){let e=I();i(0,"tr")(1,"td"),m(2),n(),i(3,"td"),m(4),n(),i(5,"td"),m(6),n(),i(7,"td"),m(8),n(),i(9,"td")(10,"button",17),v("click",function(){let t=c(e).$implicit,r=s();return p(r.select(t))}),m(11,"Ver movimientos"),n()()()}if(a&2){let e=l.$implicit;d(2),f(e.sku),d(2),E("",e.brand," ",e.modelName," ",e.size),d(2),f(e.onHand),d(2),f(e.reserved)}}function X(a,l){if(a&1&&(i(0,"span"),m(1),n()),a&2){let e=s();d(),f(e.selected.sku)}}function Y(a,l){a&1&&(i(0,"span"),m(1,"(selecciona de la lista)"),n())}function Z(a,l){if(a&1){let e=I();W(0),i(1,"div",21)(2,"div",22)(3,"input",23),_("ngModelChange",function(t){c(e);let r=s(2);return u(r.tireForm.type,t)||(r.tireForm.type=t),p(t)}),n()(),i(4,"div",22)(5,"input",24),_("ngModelChange",function(t){c(e);let r=s(2);return u(r.tireForm.loadIndex,t)||(r.tireForm.loadIndex=t),p(t)}),n()(),i(6,"div",22)(7,"input",25),_("ngModelChange",function(t){c(e);let r=s(2);return u(r.tireForm.speedRating,t)||(r.tireForm.speedRating=t),p(t)}),n()(),i(8,"div",26)(9,"button",27),v("click",function(){c(e);let t=s(2);return p(t.saveTire())}),m(10,"Guardar llanta"),n()()(),V()}if(a&2){let e=s(2);d(3),g("ngModel",e.tireForm.type),d(2),g("ngModel",e.tireForm.loadIndex),d(2),g("ngModel",e.tireForm.speedRating)}}function $(a,l){if(a&1){let e=I();i(0,"div",21)(1,"div",28)(2,"input",29),_("ngModelChange",function(t){c(e);let r=s(2);return u(r.rimForm.diameterIn,t)||(r.rimForm.diameterIn=t),p(t)}),n()(),i(3,"div",28)(4,"input",30),_("ngModelChange",function(t){c(e);let r=s(2);return u(r.rimForm.widthIn,t)||(r.rimForm.widthIn=t),p(t)}),n()(),i(5,"div",28)(6,"input",31),_("ngModelChange",function(t){c(e);let r=s(2);return u(r.rimForm.boltPattern,t)||(r.rimForm.boltPattern=t),p(t)}),n()(),i(7,"div",28)(8,"input",32),_("ngModelChange",function(t){c(e);let r=s(2);return u(r.rimForm.offsetMm,t)||(r.rimForm.offsetMm=t),p(t)}),n()(),i(9,"div",28)(10,"input",33),_("ngModelChange",function(t){c(e);let r=s(2);return u(r.rimForm.centerBoreMm,t)||(r.rimForm.centerBoreMm=t),p(t)}),n()(),i(11,"div",28)(12,"input",34),_("ngModelChange",function(t){c(e);let r=s(2);return u(r.rimForm.material,t)||(r.rimForm.material=t),p(t)}),n()(),i(13,"div",26)(14,"input",35),_("ngModelChange",function(t){c(e);let r=s(2);return u(r.rimForm.finish,t)||(r.rimForm.finish=t),p(t)}),n()(),i(15,"div",26)(16,"button",27),v("click",function(){c(e);let t=s(2);return p(t.saveRim())}),m(17,"Guardar rines"),n()()()}if(a&2){let e=s(2);d(2),g("ngModel",e.rimForm.diameterIn),d(2),g("ngModel",e.rimForm.widthIn),d(2),g("ngModel",e.rimForm.boltPattern),d(2),g("ngModel",e.rimForm.offsetMm),d(2),g("ngModel",e.rimForm.centerBoreMm),d(2),g("ngModel",e.rimForm.material),d(2),g("ngModel",e.rimForm.finish)}}function ee(a,l){if(a&1&&(i(0,"div",18)(1,"h5",9),m(2,"Especificaciones"),n(),i(3,"div",19),m(4),n(),x(5,Z,11,3,"ng-container",20)(6,$,18,7,"ng-template",null,0,j),n()),a&2){let e=R(7),o=s();d(4),E("",o.product.brand," ",o.product.modelName," \xB7 ",o.product.category||"\u2014"),d(),h("ngIf",o.product.tire)("ngIfElse",e)}}function te(a,l){if(a&1&&(i(0,"tr")(1,"td"),m(2),B(3,"date"),n(),i(4,"td"),m(5),n(),i(6,"td"),m(7),n(),i(8,"td"),m(9),n()()),a&2){let e=l.$implicit;d(2),f(k(3,4,e.createdAtUtc,"short")),d(3),f(e.quantity),d(2),f(e.type),d(2),f(e.reference)}}function ne(a,l){if(a&1&&(i(0,"div",36)(1,"h6"),m(2,"Movimientos"),n(),i(3,"div",37)(4,"table",38)(5,"thead")(6,"tr")(7,"th"),m(8,"Fecha"),n(),i(9,"th"),m(10,"Cant"),n(),i(11,"th"),m(12,"Tipo"),n(),i(13,"th"),m(14,"Ref"),n()()(),i(15,"tbody"),x(16,te,10,7,"tr",6),n()()()()),a&2){let e=s();d(16),h("ngForOf",e.txns)}}var J=class a{#e=y(C);#t=y(D);#n=y(S);rows=[];txns=[];selected=null;delta=null;reason="";product=null;tireForm={type:"",loadIndex:"",speedRating:""};rimForm={diameterIn:null,widthIn:null,boltPattern:"",offsetMm:null,centerBoreMm:null,material:"",finish:""};ngOnInit(){this.reload()}reload(){this.#e.list().subscribe({next:l=>this.rows=l,error:()=>this.rows=[]})}select(l){this.selected=l,this.#e.transactions(l.id,1,50).subscribe({next:e=>this.txns=e.items,error:()=>this.txns=[]}),this.#t.getProduct(l.id).subscribe({next:e=>{this.product=e,this.tireForm=P({},e.tire||{type:"",loadIndex:"",speedRating:""}),this.rimForm=P({},e.rim||{diameterIn:null,widthIn:null,boltPattern:"",offsetMm:null,centerBoreMm:null,material:"",finish:""})},error:()=>this.product=null})}adjust(){!this.selected||this.delta===null||this.#e.adjust(this.selected.id,this.delta,this.reason).subscribe({next:()=>{this.delta=null,this.reason="",this.reload(),this.selected&&this.select(this.selected)},error:()=>{}})}saveTire(){this.selected&&this.#n.upsertTire(this.selected.id,this.tireForm).subscribe({next:()=>this.select(this.selected),error:()=>{}})}saveRim(){this.selected&&this.#n.upsertRim(this.selected.id,this.rimForm).subscribe({next:()=>this.select(this.selected),error:()=>{}})}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=A({type:a,selectors:[["ng-component"]],decls:34,vars:10,consts:[["rimFormTpl",""],[1,"container","my-4"],[1,"row","g-2","mb-3"],[1,"col-12","col-md-8"],[1,"table-responsive"],[1,"table","align-middle"],[4,"ngFor","ngForOf"],[1,"col-12","col-md-4"],[1,"card","p-3"],[1,"card-title"],[1,"mb-2","small","text-muted"],[4,"ngIf"],["type","number","placeholder","Delta (ej. 5 o -3)",1,"form-control","mb-2",3,"ngModelChange","ngModel","disabled"],["placeholder","Motivo",1,"form-control","mb-2",3,"ngModelChange","ngModel","disabled"],[1,"btn","btn-dark",3,"click","disabled"],["class","card p-3 mt-3",4,"ngIf"],["class","mt-3",4,"ngIf"],[1,"btn","btn-sm","btn-outline-secondary",3,"click"],[1,"card","p-3","mt-3"],[1,"small","text-muted","mb-2"],[4,"ngIf","ngIfElse"],[1,"row","g-2"],[1,"col-12","col-sm-6"],["placeholder","Tipo","name","tType",1,"form-control",3,"ngModelChange","ngModel"],["placeholder","Rango carga","name","tLoad",1,"form-control",3,"ngModelChange","ngModel"],["placeholder","Rango velocidad","name","tSpeed",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-12"],[1,"btn","btn-outline-dark",3,"click"],[1,"col-6"],["type","number","step","0.1","placeholder","Di\xE1metro (in)","name","rDia",1,"form-control",3,"ngModelChange","ngModel"],["type","number","step","0.1","placeholder","Ancho (in)","name","rWidth",1,"form-control",3,"ngModelChange","ngModel"],["placeholder","Patr\xF3n (5x114.3)","name","rPattern",1,"form-control",3,"ngModelChange","ngModel"],["type","number","placeholder","Offset (mm)","name","rOffset",1,"form-control",3,"ngModelChange","ngModel"],["type","number","step","0.1","placeholder","Centro (mm)","name","rCb",1,"form-control",3,"ngModelChange","ngModel"],["placeholder","Material","name","rMat",1,"form-control",3,"ngModelChange","ngModel"],["placeholder","Acabado","name","rFin",1,"form-control",3,"ngModelChange","ngModel"],[1,"mt-3"],[1,"table-responsive",2,"max-height","260px"],[1,"table","table-sm"]],template:function(e,o){e&1&&(i(0,"section",1)(1,"h2"),m(2,"Inventario (Admin)"),n(),i(3,"div",2)(4,"div",3)(5,"div",4)(6,"table",5)(7,"thead")(8,"tr")(9,"th"),m(10,"SKU"),n(),i(11,"th"),m(12,"Producto"),n(),i(13,"th"),m(14,"OnHand"),n(),i(15,"th"),m(16,"Reservado"),n(),T(17,"th"),n()(),i(18,"tbody"),x(19,Q,12,6,"tr",6),n()()()(),i(20,"div",7)(21,"div",8)(22,"h5",9),m(23,"Ajustar inventario"),n(),i(24,"div",10),m(25,"Producto: "),x(26,X,2,1,"span",11)(27,Y,2,0,"span",11),n(),i(28,"input",12),_("ngModelChange",function(r){return u(o.delta,r)||(o.delta=r),r}),n(),i(29,"input",13),_("ngModelChange",function(r){return u(o.reason,r)||(o.reason=r),r}),n(),i(30,"button",14),v("click",function(){return o.adjust()}),m(31,"Aplicar"),n()(),x(32,ee,8,5,"div",15)(33,ne,17,1,"div",16),n()()()),e&2&&(d(19),h("ngForOf",o.rows),d(7),h("ngIf",o.selected),d(),h("ngIf",!o.selected),d(),g("ngModel",o.delta),h("disabled",!o.selected),d(),g("ngModel",o.reason),h("disabled",!o.selected),d(),h("disabled",!o.selected||!o.delta),d(2),h("ngIf",o.product),d(),h("ngIf",o.txns.length))},dependencies:[L,N,G,H,q,U,z,O],encapsulation:2})};export{J as InventoryAdminPage};
