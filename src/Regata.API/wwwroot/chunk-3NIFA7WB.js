import{a as k}from"./chunk-I2ARM4MU.js";import{a as H}from"./chunk-UFE4MYJG.js";import"./chunk-VERFBTRB.js";import{a as j,b as B,c as D,d as L,e as q,f as G,k as R,l as U,m as z}from"./chunk-CVTXNI7X.js";import{g as V,h as T,j as O,k as A,r as W,u as F}from"./chunk-DW6AFCKZ.js";import{$ as p,$a as m,Aa as o,Ab as v,Bb as h,Cb as b,Gb as E,Ib as S,Ja as I,Kb as M,Oa as g,Q as N,V as x,aa as u,ab as n,bb as t,hb as P,kb as f,lb as l,sb as C,ub as w,vb as s,wb as _}from"./chunk-BIY3REYI.js";var y=class i{#e=x(W);#t=F.apiBaseUrl+"/account";me(){return this.#e.get(`${this.#t}/me`,{withCredentials:!0})}updateProfile(r){return this.#e.put(`${this.#t}/profile`,r,{withCredentials:!0})}changePassword(r){return this.#e.post(`${this.#t}/change-password`,r,{withCredentials:!0})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=N({token:i,factory:i.\u0275fac,providedIn:"root"})};function K(i,r){i&1&&(n(0,"span",24),s(1,"Guardado"),t())}function Q(i,r){if(i&1&&(n(0,"span",25),s(1),t()),i&2){let e=l(3);o(),_(e.error)}}function Y(i,r){if(i&1){let e=P();n(0,"div",14)(1,"form",15),f("submit",function(a){p(e);let d=l(2);return u(d.saveProfile(a))}),n(2,"div",16)(3,"label",17),s(4,"Nombre"),t(),n(5,"input",18),b("ngModelChange",function(a){p(e);let d=l(2);return h(d.profile.displayName,a)||(d.profile.displayName=a),u(a)}),t()(),n(6,"div",16)(7,"label",17),s(8,"Tel\xE9fono"),t(),n(9,"input",19),b("ngModelChange",function(a){p(e);let d=l(2);return h(d.profile.phoneNumber,a)||(d.profile.phoneNumber=a),u(a)}),t()(),n(10,"div",20)(11,"button",21),s(12,"Guardar cambios"),t(),g(13,K,2,0,"span",22)(14,Q,2,1,"span",23),t()()()}if(i&2){let e=l(2);o(5),v("ngModel",e.profile.displayName),o(4),v("ngModel",e.profile.phoneNumber),o(2),m("disabled",e.saving),o(2),m("ngIf",e.saved),o(),m("ngIf",e.error)}}function Z(i,r){i&1&&(n(0,"span",24),s(1,"Actualizada"),t())}function $(i,r){if(i&1&&(n(0,"span",25),s(1),t()),i&2){let e=l(3);o(),_(e.error)}}function ee(i,r){if(i&1){let e=P();n(0,"div",14)(1,"form",15),f("submit",function(a){p(e);let d=l(2);return u(d.changePassword(a))}),n(2,"div",26)(3,"label",17),s(4,"Actual"),t(),n(5,"input",27),b("ngModelChange",function(a){p(e);let d=l(2);return h(d.security.currentPassword,a)||(d.security.currentPassword=a),u(a)}),t()(),n(6,"div",26)(7,"label",17),s(8,"Nueva"),t(),n(9,"input",28),b("ngModelChange",function(a){p(e);let d=l(2);return h(d.security.newPassword,a)||(d.security.newPassword=a),u(a)}),t()(),n(10,"div",26)(11,"label",17),s(12,"Confirmar"),t(),n(13,"input",29),b("ngModelChange",function(a){p(e);let d=l(2);return h(d.security.confirm,a)||(d.security.confirm=a),u(a)}),t()(),n(14,"div",20)(15,"button",21),s(16,"Actualizar contrase\xF1a"),t(),g(17,Z,2,0,"span",22)(18,$,2,1,"span",23),t()()()}if(i&2){let e=l(2);o(5),v("ngModel",e.security.currentPassword),o(4),v("ngModel",e.security.newPassword),o(4),v("ngModel",e.security.confirm),o(2),m("disabled",e.changing),o(2),m("ngIf",e.changed),o(),m("ngIf",e.error)}}function te(i,r){if(i&1&&(n(0,"tr")(1,"td",34),s(2),t(),n(3,"td"),s(4),E(5,"date"),t(),n(6,"td"),s(7),E(8,"currency"),t(),n(9,"td"),s(10),t()()),i&2){let e=r.$implicit;o(2),_(e.id),o(2),_(S(5,4,e.createdAtUtc,"medium")),o(3),_(S(8,7,e.total,"MXN")),o(3),_(e.status)}}function ie(i,r){if(i&1&&(n(0,"div")(1,"div",31)(2,"table",32)(3,"thead")(4,"tr")(5,"th"),s(6,"Folio"),t(),n(7,"th"),s(8,"Fecha"),t(),n(9,"th"),s(10,"Total"),t(),n(11,"th"),s(12,"Estado"),t()()(),n(13,"tbody"),g(14,te,11,10,"tr",33),t()()()()),i&2){let e=l(3);o(14),m("ngForOf",e.orders)}}function ne(i,r){i&1&&(n(0,"div",9),s(1,"A\xFAn no tienes pedidos."),t())}function re(i,r){if(i&1&&(n(0,"div",14),g(1,ie,15,1,"div",30)(2,ne,2,0,"ng-template",null,1,M),t()),i&2){let e=C(3),c=l(2);o(),m("ngIf",c.orders.length)("ngIfElse",e)}}function ae(i,r){if(i&1){let e=P();n(0,"div",5)(1,"div",6)(2,"div",7)(3,"div")(4,"div",8),s(5),t(),n(6,"small",9),s(7),t()(),n(8,"button",10),f("click",function(){p(e);let a=l();return u(a.logout())}),s(9,"Cerrar sesi\xF3n"),t()()(),n(10,"div",11)(11,"button",12),f("click",function(){p(e);let a=l();return u(a.tab="perfil")}),s(12,"Perfil"),t(),n(13,"button",12),f("click",function(){p(e);let a=l();return u(a.tab="seguridad")}),s(14,"Seguridad"),t(),n(15,"button",12),f("click",function(){p(e);let a=l();return u(a.tab="pedidos")}),s(16,"Pedidos"),t()(),g(17,Y,15,5,"div",13)(18,ee,19,6,"div",13)(19,re,4,2,"div",13),t()}if(i&2){let e=l();o(5),_(e.me.displayName||"Usuario"),o(2),_(e.me.email),o(4),w("active",e.tab==="perfil"),o(2),w("active",e.tab==="seguridad"),o(2),w("active",e.tab==="pedidos"),o(2),m("ngIf",e.tab==="perfil"),o(),m("ngIf",e.tab==="seguridad"),o(),m("ngIf",e.tab==="pedidos")}}function oe(i,r){i&1&&(n(0,"p",9),s(1,"Cargando tu informaci\xF3n\u2026"),t())}var X=class i{#e=x(y);#t=x(k);#n=x(H);me=null;tab="perfil";profile={displayName:"",phoneNumber:""};saving=!1;saved=!1;error="";security={currentPassword:"",newPassword:"",confirm:""};changing=!1;changed=!1;orders=[];ngOnInit(){this.refresh()}refresh(){this.#e.me().subscribe({next:r=>{this.me=r,this.profile.displayName=r.displayName||"",this.profile.phoneNumber=r.phoneNumber||"",this.loadOrders()},error:()=>this.me=null})}loadOrders(){this.#n.listMine().subscribe({next:r=>this.orders=r,error:()=>this.orders=[]})}saveProfile(r){r.preventDefault(),this.error="",this.saved=!1,this.saving=!0,this.#e.updateProfile({displayName:this.profile.displayName,phoneNumber:this.profile.phoneNumber}).subscribe({next:()=>{this.saving=!1,this.saved=!0,this.refresh()},error:e=>{this.saving=!1,this.error=this.#i(e)}})}changePassword(r){if(r.preventDefault(),this.error="",this.changed=!1,this.changing=!0,this.security.newPassword!==this.security.confirm){this.error="Las contrase\xF1as no coinciden",this.changing=!1;return}this.#e.changePassword({currentPassword:this.security.currentPassword,newPassword:this.security.newPassword}).subscribe({next:()=>{this.changing=!1,this.changed=!0,this.security={currentPassword:"",newPassword:"",confirm:""}},error:e=>{this.changing=!1,this.error=this.#i(e)}})}logout(){this.#t.logout().subscribe({next:()=>{this.me=null},error:()=>{this.me=null}})}#i(r){return r?.error?.errors?Object.values(r.error.errors).flat().join(" "):typeof r?.error=="string"?r.error:"Ocurri\xF3 un error."}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=I({type:i,selectors:[["ng-component"]],decls:6,vars:2,consts:[["loading",""],["noOrders",""],[1,"container","my-4"],[1,"mb-3"],["class","card p-0 overflow-hidden",4,"ngIf","ngIfElse"],[1,"card","p-0","overflow-hidden"],[1,"p-3","border-bottom","bg-body-tertiary"],[1,"d-flex","justify-content-between","align-items-center"],[1,"fw-semibold"],[1,"text-muted"],[1,"btn","btn-outline-danger","btn-sm",3,"click"],[1,"tabs","px-3","d-flex","gap-2"],[1,"tab-btn",3,"click"],["class","p-3",4,"ngIf"],[1,"p-3"],[1,"row","g-3",3,"submit"],[1,"col-12","col-md-6"],[1,"form-label"],["name","displayName","placeholder","Tu nombre",1,"form-control",3,"ngModelChange","ngModel"],["name","phoneNumber","placeholder","10 d\xEDgitos",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-12"],["type","submit",1,"btn","btn-dark",3,"disabled"],["class","text-success ms-2",4,"ngIf"],["class","text-danger ms-2",4,"ngIf"],[1,"text-success","ms-2"],[1,"text-danger","ms-2"],[1,"col-12","col-md-4"],["type","password","name","currentPassword","required","","minlength","6",1,"form-control",3,"ngModelChange","ngModel"],["type","password","name","newPassword","required","","minlength","6",1,"form-control",3,"ngModelChange","ngModel"],["type","password","name","confirm","required","","minlength","6",1,"form-control",3,"ngModelChange","ngModel"],[4,"ngIf","ngIfElse"],[1,"table-responsive"],[1,"table","align-middle"],[4,"ngFor","ngForOf"],[1,"small"]],template:function(e,c){if(e&1&&(n(0,"section",2)(1,"h2",3),s(2,"Tu cuenta"),t(),g(3,ae,20,11,"div",4)(4,oe,2,0,"ng-template",null,0,M),t()),e&2){let a=C(5);o(3),m("ngIf",c.me)("ngIfElse",a)}},dependencies:[T,V,z,G,j,B,D,R,U,q,L,A,O],styles:[".card[_ngcontent-%COMP%]{border-radius:.75rem;border:1px solid rgba(0,0,0,.08)}.tabs[_ngcontent-%COMP%]{border-bottom:1px solid rgba(0,0,0,.08)}.tab-btn[_ngcontent-%COMP%]{border:none;background:transparent;padding:.75rem 1rem;font-weight:600}.tab-btn.active[_ngcontent-%COMP%]{color:var(--jdm-red);border-bottom:2px solid var(--jdm-red)}"]})};export{X as PerfilPage};
