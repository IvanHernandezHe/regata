import{a as B}from"./chunk-LEWAVDQT.js";import{a as K}from"./chunk-VNGMKSSX.js";import{e as L}from"./chunk-WKLMLA3H.js";import"./chunk-C5GIYBMA.js";import{b as D,c as q,d as R,e as G,f as U,g as z,n as H,o as X,p as J}from"./chunk-VNE54M5M.js";import{a as j}from"./chunk-CLVRU5UC.js";import{g as k,h as O,j as A,k as F,r as W}from"./chunk-N2J27IAP.js";import{Da as o,Eb as v,Fb as h,Gb as b,Lb as T,Ma as I,Mb as E,Ob as S,Qb as M,R as N,Ra as g,W as x,aa as p,ba as u,cb as m,db as n,eb as t,fb as V,kb as P,nb as f,ob as l,vb as C,xb as w,yb as s,zb as _}from"./chunk-KUB3M4GV.js";var y=class i{#e=x(W);#t=j.apiBaseUrl+"/account";me(){return this.#e.get(`${this.#t}/me`,{withCredentials:!0})}updateProfile(r){return this.#e.put(`${this.#t}/profile`,r,{withCredentials:!0})}changePassword(r){return this.#e.post(`${this.#t}/change-password`,r,{withCredentials:!0})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=N({token:i,factory:i.\u0275fac,providedIn:"root"})};var Z=i=>["/orders",i];function $(i,r){i&1&&(n(0,"span",24),s(1,"Guardado"),t())}function ee(i,r){if(i&1&&(n(0,"span",25),s(1),t()),i&2){let e=l(3);o(),_(e.error)}}function te(i,r){if(i&1){let e=P();n(0,"div",14)(1,"form",15),f("submit",function(a){p(e);let d=l(2);return u(d.saveProfile(a))}),n(2,"div",16)(3,"label",17),s(4,"Nombre"),t(),n(5,"input",18),b("ngModelChange",function(a){p(e);let d=l(2);return h(d.profile.displayName,a)||(d.profile.displayName=a),u(a)}),t()(),n(6,"div",16)(7,"label",17),s(8,"Tel\xE9fono"),t(),n(9,"input",19),b("ngModelChange",function(a){p(e);let d=l(2);return h(d.profile.phoneNumber,a)||(d.profile.phoneNumber=a),u(a)}),t()(),n(10,"div",20)(11,"button",21),s(12,"Guardar cambios"),t(),g(13,$,2,0,"span",22)(14,ee,2,1,"span",23),t()()()}if(i&2){let e=l(2);o(5),v("ngModel",e.profile.displayName),o(4),v("ngModel",e.profile.phoneNumber),o(2),m("disabled",e.saving),o(2),m("ngIf",e.saved),o(),m("ngIf",e.error)}}function ie(i,r){i&1&&(n(0,"span",24),s(1,"Actualizada"),t())}function ne(i,r){if(i&1&&(n(0,"span",25),s(1),t()),i&2){let e=l(3);o(),_(e.error)}}function re(i,r){if(i&1){let e=P();n(0,"div",14)(1,"form",15),f("submit",function(a){p(e);let d=l(2);return u(d.changePassword(a))}),n(2,"div",26)(3,"label",17),s(4,"Actual"),t(),n(5,"input",27),b("ngModelChange",function(a){p(e);let d=l(2);return h(d.security.currentPassword,a)||(d.security.currentPassword=a),u(a)}),t()(),n(6,"div",26)(7,"label",17),s(8,"Nueva"),t(),n(9,"input",28),b("ngModelChange",function(a){p(e);let d=l(2);return h(d.security.newPassword,a)||(d.security.newPassword=a),u(a)}),t()(),n(10,"div",26)(11,"label",17),s(12,"Confirmar"),t(),n(13,"input",29),b("ngModelChange",function(a){p(e);let d=l(2);return h(d.security.confirm,a)||(d.security.confirm=a),u(a)}),t()(),n(14,"div",20)(15,"button",21),s(16,"Actualizar contrase\xF1a"),t(),g(17,ie,2,0,"span",22)(18,ne,2,1,"span",23),t()()()}if(i&2){let e=l(2);o(5),v("ngModel",e.security.currentPassword),o(4),v("ngModel",e.security.newPassword),o(4),v("ngModel",e.security.confirm),o(2),m("disabled",e.changing),o(2),m("ngIf",e.changed),o(),m("ngIf",e.error)}}function ae(i,r){if(i&1){let e=P();n(0,"button",38),f("click",function(){p(e);let a=l().$implicit,d=l(4);return u(d.cancel(a.id))}),s(1,"Cancelar"),t()}}function oe(i,r){if(i&1&&(n(0,"tr")(1,"td",34)(2,"a",35),s(3),t()(),n(4,"td"),s(5),E(6,"date"),t(),n(7,"td"),s(8),E(9,"currency"),t(),n(10,"td"),s(11),t(),n(12,"td",36),g(13,ae,2,0,"button",37),t()()),i&2){let e=r.$implicit;o(2),m("routerLink",T(12,Z,e.id)),o(),_(e.id),o(2),_(S(6,6,e.createdAtUtc,"medium")),o(3),_(S(9,9,e.total,"MXN")),o(3),_(e.status),o(2),m("ngIf",e.status==="Created")}}function se(i,r){if(i&1&&(n(0,"div")(1,"div",31)(2,"table",32)(3,"thead")(4,"tr")(5,"th"),s(6,"Folio"),t(),n(7,"th"),s(8,"Fecha"),t(),n(9,"th"),s(10,"Total"),t(),n(11,"th"),s(12,"Estado"),t(),V(13,"th"),t()(),n(14,"tbody"),g(15,oe,14,14,"tr",33),t()()()()),i&2){let e=l(3);o(15),m("ngForOf",e.orders)}}function le(i,r){i&1&&(n(0,"div",9),s(1,"A\xFAn no tienes pedidos."),t())}function de(i,r){if(i&1&&(n(0,"div",14),g(1,se,16,1,"div",30)(2,le,2,0,"ng-template",null,1,M),t()),i&2){let e=C(3),c=l(2);o(),m("ngIf",c.orders.length)("ngIfElse",e)}}function ce(i,r){if(i&1){let e=P();n(0,"div",5)(1,"div",6)(2,"div",7)(3,"div")(4,"div",8),s(5),t(),n(6,"small",9),s(7),t()(),n(8,"button",10),f("click",function(){p(e);let a=l();return u(a.logout())}),s(9,"Cerrar sesi\xF3n"),t()()(),n(10,"div",11)(11,"button",12),f("click",function(){p(e);let a=l();return u(a.tab="perfil")}),s(12,"Perfil"),t(),n(13,"button",12),f("click",function(){p(e);let a=l();return u(a.tab="seguridad")}),s(14,"Seguridad"),t(),n(15,"button",12),f("click",function(){p(e);let a=l();return u(a.tab="pedidos")}),s(16,"Pedidos"),t()(),g(17,te,15,5,"div",13)(18,re,19,6,"div",13)(19,de,4,2,"div",13),t()}if(i&2){let e=l();o(5),_(e.me.displayName||"Usuario"),o(2),_(e.me.email),o(4),w("active",e.tab==="perfil"),o(2),w("active",e.tab==="seguridad"),o(2),w("active",e.tab==="pedidos"),o(2),m("ngIf",e.tab==="perfil"),o(),m("ngIf",e.tab==="seguridad"),o(),m("ngIf",e.tab==="pedidos")}}function me(i,r){i&1&&(n(0,"p",9),s(1,"Cargando tu informaci\xF3n\u2026"),t())}var Q=class i{#e=x(y);#t=x(B);#i=x(K);me=null;tab="perfil";profile={displayName:"",phoneNumber:""};saving=!1;saved=!1;error="";security={currentPassword:"",newPassword:"",confirm:""};changing=!1;changed=!1;orders=[];canceling=!1;ngOnInit(){this.refresh()}refresh(){this.#e.me().subscribe({next:r=>{this.me=r,this.profile.displayName=r.displayName||"",this.profile.phoneNumber=r.phoneNumber||"",this.loadOrders()},error:()=>this.me=null})}loadOrders(){this.#i.listMine().subscribe({next:r=>this.orders=r,error:()=>this.orders=[]})}cancel(r){confirm("\xBFCancelar este pedido?")&&(this.canceling=!0,this.#i.cancel(r).subscribe({next:()=>{this.canceling=!1,this.loadOrders()},error:e=>{this.canceling=!1,alert(e?.error?.error||"No se pudo cancelar")}}))}saveProfile(r){r.preventDefault(),this.error="",this.saved=!1,this.saving=!0,this.#e.updateProfile({displayName:this.profile.displayName,phoneNumber:this.profile.phoneNumber}).subscribe({next:()=>{this.saving=!1,this.saved=!0,this.refresh()},error:e=>{this.saving=!1,this.error=this.#n(e)}})}changePassword(r){if(r.preventDefault(),this.error="",this.changed=!1,this.changing=!0,this.security.newPassword!==this.security.confirm){this.error="Las contrase\xF1as no coinciden",this.changing=!1;return}this.#e.changePassword({currentPassword:this.security.currentPassword,newPassword:this.security.newPassword}).subscribe({next:()=>{this.changing=!1,this.changed=!0,this.security={currentPassword:"",newPassword:"",confirm:""}},error:e=>{this.changing=!1,this.error=this.#n(e)}})}logout(){this.#t.logout().subscribe({next:()=>{this.me=null},error:()=>{this.me=null}})}#n(r){return r?.error?.errors?Object.values(r.error.errors).flat().join(" "):typeof r?.error=="string"?r.error:"Ocurri\xF3 un error."}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=I({type:i,selectors:[["ng-component"]],decls:6,vars:2,consts:[["loading",""],["noOrders",""],[1,"container","my-4"],[1,"mb-3"],["class","card p-0 overflow-hidden",4,"ngIf","ngIfElse"],[1,"card","p-0","overflow-hidden"],[1,"p-3","border-bottom","bg-body-tertiary"],[1,"d-flex","justify-content-between","align-items-center"],[1,"fw-semibold"],[1,"text-muted"],[1,"btn","btn-outline-danger","btn-sm",3,"click"],[1,"tabs","px-3","d-flex","gap-2"],[1,"tab-btn",3,"click"],["class","p-3",4,"ngIf"],[1,"p-3"],[1,"row","g-3",3,"submit"],[1,"col-12","col-md-6"],[1,"form-label"],["name","displayName","placeholder","Tu nombre",1,"form-control",3,"ngModelChange","ngModel"],["name","phoneNumber","placeholder","10 d\xEDgitos",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-12"],["type","submit",1,"btn","btn-dark",3,"disabled"],["class","text-success ms-2",4,"ngIf"],["class","text-danger ms-2",4,"ngIf"],[1,"text-success","ms-2"],[1,"text-danger","ms-2"],[1,"col-12","col-md-4"],["type","password","name","currentPassword","required","","minlength","6",1,"form-control",3,"ngModelChange","ngModel"],["type","password","name","newPassword","required","","minlength","6",1,"form-control",3,"ngModelChange","ngModel"],["type","password","name","confirm","required","","minlength","6",1,"form-control",3,"ngModelChange","ngModel"],[4,"ngIf","ngIfElse"],[1,"table-responsive"],[1,"table","align-middle"],[4,"ngFor","ngForOf"],[1,"small"],[3,"routerLink"],[1,"text-end"],["class","btn btn-sm btn-outline-danger",3,"click",4,"ngIf"],[1,"btn","btn-sm","btn-outline-danger",3,"click"]],template:function(e,c){if(e&1&&(n(0,"section",2)(1,"h2",3),s(2,"Tu cuenta"),t(),g(3,ce,20,11,"div",4)(4,me,2,0,"ng-template",null,0,M),t()),e&2){let a=C(5);o(3),m("ngIf",c.me)("ngIfElse",a)}},dependencies:[O,k,J,z,D,q,R,H,X,U,G,L,F,A],styles:[".card[_ngcontent-%COMP%]{border-radius:.75rem;border:1px solid rgba(0,0,0,.08)}.tabs[_ngcontent-%COMP%]{border-bottom:1px solid rgba(0,0,0,.08)}.tab-btn[_ngcontent-%COMP%]{border:none;background:transparent;padding:.75rem 1rem;font-weight:600}.tab-btn.active[_ngcontent-%COMP%]{color:var(--jdm-red);border-bottom:2px solid var(--jdm-red)}"]})};export{Q as PerfilPage};
