import{a as H}from"./chunk-MSQ666XJ.js";import{b as N}from"./chunk-OGOOJ37H.js";import{b as T,c as W,d as L,e as B,f as Q,g as q,h as F,j as R,k as U,l as X,m as G,n as z,p as j}from"./chunk-Z6ULA57Y.js";import{g as O,h as V,k}from"./chunk-FNKGIW6C.js";import{Ba as o,Bb as A,Cb as x,Db as h,Eb as S,Ib as y,Ka as w,Kb as v,Mb as D,Pa as f,W as b,aa as m,ab as _,ba as p,bb as t,cb as i,db as I,ib as C,lb as g,mb as c,tb as P,wb as n,xb as u,yb as E,zb as M}from"./chunk-7DVQ7J3I.js";function Y(s,l){if(s&1){let e=C();t(0,"tr")(1,"td"),n(2),i(),t(3,"td"),n(4),i(),t(5,"td")(6,"div",40)(7,"button",41),g("click",function(){let r=m(e).$implicit,a=c(2);return p(a.dec(r.productId,r.quantity))}),n(8,"\u2212"),i(),t(9,"input",42),g("change",function(r){let a=m(e).$implicit,J=c(2);return p(J.setQty(a.productId,r.target.value))}),i(),t(10,"button",41),g("click",function(){let r=m(e).$implicit,a=c(2);return p(a.inc(r.productId,r.quantity))}),n(11,"+"),i()()(),t(12,"td"),n(13),y(14,"currency"),i(),t(15,"td"),n(16),y(17,"currency"),i(),t(18,"td",43)(19,"button",44),g("click",function(){let r=m(e).$implicit,a=c(2);return p(a.remove(r.productId))}),n(20,"Quitar"),i()()()}if(s&2){let e=l.$implicit;o(2),M("",e.productName," \xB7 ",e.size),o(2),u(e.productSku),o(5),_("value",e.quantity),o(4),u(v(14,6,e.unitPrice,"MXN")),o(3),u(v(17,9,e.unitPrice*e.quantity,"MXN"))}}function Z(s,l){if(s&1&&(t(0,"div",45),n(1),y(2,"currency"),i()),s&2){let e=c().ngIf;o(),E("Descuento: \u2212",v(2,1,e.discountAmount,"MXN"))}}function $(s,l){if(s&1&&(t(0,"div",24),n(1,"Referencia: "),t(2,"code"),n(3),i()()),s&2){let e=c().ngIf;o(3),u(e.paymentReference)}}function ee(s,l){if(s&1&&(t(0,"div"),n(1),i()),s&2){let e=c(2).ngIf;o(),u(e.ship.shipLine2)}}function te(s,l){if(s&1&&(t(0,"div",19)(1,"div",20),n(2,"Env\xEDo"),i(),t(3,"div"),n(4),i(),f(5,ee,2,1,"div",46),t(6,"div",21),n(7),i()()),s&2){let e=c().ngIf;o(4),u(e.ship.shipLine1),o(),_("ngIf",e.ship.shipLine2),o(2),A("",e.ship.shipCity,", ",e.ship.shipState," ",e.ship.shipPostalCode," \xB7 ",e.ship.shipCountry)}}function ie(s,l){if(s&1){let e=C();t(0,"section",2)(1,"h2"),n(2),i(),t(3,"div",3)(4,"div",4)(5,"div",5)(6,"h5",6),n(7,"Art\xEDculos"),i(),t(8,"div",7)(9,"table",8)(10,"thead")(11,"tr")(12,"th"),n(13,"Producto"),i(),t(14,"th"),n(15,"SKU"),i(),t(16,"th",9),n(17,"Cant"),i(),t(18,"th"),n(19,"Precio"),i(),t(20,"th"),n(21,"Importe"),i(),I(22,"th"),i()(),t(23,"tbody"),f(24,Y,21,12,"tr",10),i()(),t(25,"form",11),g("submit",function(r){m(e);let a=c();return p(a.addItem(r))}),t(26,"div",12)(27,"input",13),S("ngModelChange",function(r){m(e);let a=c();return h(a.addProductId,r)||(a.addProductId=r),p(r)}),i()(),t(28,"div",14)(29,"input",15),S("ngModelChange",function(r){m(e);let a=c();return h(a.addQty,r)||(a.addQty=r),p(r)}),i()(),t(30,"div",16)(31,"button",17),n(32,"Agregar"),i()()()()()(),t(33,"div",18)(34,"div",19)(35,"div",20),n(36,"Cliente"),i(),t(37,"div",21),n(38),i(),t(39,"div",22)(40,"strong"),n(41,"Total:"),i(),n(42),y(43,"currency"),i(),t(44,"div"),n(45),y(46,"currency"),i(),f(47,Z,3,4,"div",23),t(48,"div"),n(49),y(50,"currency"),i()(),t(51,"div",19)(52,"div",20),n(53,"Pago"),i(),t(54,"div",24),n(55,"Proveedor: "),t(56,"span",25),n(57),i()(),t(58,"div",24),n(59,"Estado: "),t(60,"span",26),n(61),i()(),f(62,$,4,1,"div",27),i(),f(63,te,8,6,"div",28),t(64,"div",5)(65,"div",29)(66,"label",30),n(67,"Estado"),i(),t(68,"select",31),S("ngModelChange",function(r){m(e);let a=c();return h(a.status,r)||(a.status=r),p(r)}),t(69,"option"),n(70,"Created"),i(),t(71,"option"),n(72,"Paid"),i(),t(73,"option"),n(74,"Preparing"),i(),t(75,"option"),n(76,"Shipped"),i(),t(77,"option"),n(78,"Completed"),i(),t(79,"option"),n(80,"Cancelled"),i()()(),t(81,"div",29)(82,"label",30),n(83,"Pago"),i(),t(84,"select",31),S("ngModelChange",function(r){m(e);let a=c();return h(a.paymentStatus,r)||(a.paymentStatus=r),p(r)}),t(85,"option"),n(86,"Pending"),i(),t(87,"option"),n(88,"Succeeded"),i(),t(89,"option"),n(90,"Failed"),i(),t(91,"option"),n(92,"Refunded"),i()()(),t(93,"div",32)(94,"button",33),g("click",function(){m(e);let r=c();return p(r.save())}),n(95,"Guardar"),i(),t(96,"button",34),g("click",function(){m(e);let r=c();return p(r.deleteOrder())}),n(97,"Eliminar pedido"),i()()(),t(98,"div",35)(99,"h6",6),n(100,"Env\xEDo"),i(),t(101,"div",29)(102,"label",30),n(103,"Paqueter\xEDa"),i(),t(104,"input",36),S("ngModelChange",function(r){m(e);let a=c();return h(a.carrier,r)||(a.carrier=r),p(r)}),i()(),t(105,"div",29)(106,"label",30),n(107,"Gu\xEDa"),i(),t(108,"input",37),S("ngModelChange",function(r){m(e);let a=c();return h(a.trackingCode,r)||(a.trackingCode=r),p(r)}),i()(),t(109,"div",29)(110,"label",30),n(111,"Fecha de env\xEDo"),i(),t(112,"input",38),S("ngModelChange",function(r){m(e);let a=c();return h(a.shippedAtLocal,r)||(a.shippedAtLocal=r),p(r)}),i()(),t(113,"button",39),g("click",function(){m(e);let r=c();return p(r.saveShipment())}),n(114,"Guardar env\xEDo"),i()()()()()}if(s&2){let e=l.ngIf,d=c();o(2),E("Pedido ",e.id),o(22),_("ngForOf",e.items),o(3),x("ngModel",d.addProductId),o(2),x("ngModel",d.addQty),o(9),u(e.userEmail),o(4),E(" ",v(43,18,e.total,"MXN")),o(3),E("Subtotal: ",v(46,21,e.subtotal,"MXN")),o(2),_("ngIf",e.discountAmount>0),o(2),E("Env\xEDo: ",v(50,24,e.shippingCost,"MXN")),o(8),u(e.paymentProvider),o(4),u(e.paymentStatus),o(),_("ngIf",e.paymentReference),o(),_("ngIf",e.ship),o(5),x("ngModel",d.status),o(16),x("ngModel",d.paymentStatus),o(20),x("ngModel",d.carrier),o(4),x("ngModel",d.trackingCode),o(4),x("ngModel",d.shippedAtLocal)}}function ne(s,l){s&1&&(t(0,"div",2),n(1,"Cargando\u2026"),i())}var K=class s{#t=b(N);#e=b(H);o=null;status="Created";paymentStatus="Pending";carrier="";trackingCode="";shippedAtLocal="";addProductId="";addQty=1;ngOnInit(){let l=this.#t.snapshot.paramMap.get("id");this.#e.get(l).subscribe({next:e=>{this.o=e,this.status=String(e.status),this.paymentStatus=String(e.paymentStatus),this.carrier=e.ship?.trackingCarrier||"",this.trackingCode=e.ship?.trackingCode||"",this.shippedAtLocal=e.ship?.shippedAtUtc?e.ship.shippedAtUtc.substring(0,16):""},error:()=>this.o=null})}save(){this.o&&(this.#e.setStatus(this.o.id,this.status).subscribe({next:()=>{},error:()=>{}}),this.#e.setPaymentStatus(this.o.id,this.paymentStatus).subscribe({next:()=>{},error:()=>{}}))}saveShipment(){if(!this.o)return;let l=this.shippedAtLocal?new Date(this.shippedAtLocal).toISOString():null;this.#e.setShipment(this.o.id,{carrier:this.carrier||void 0,trackingCode:this.trackingCode||void 0,shippedAtUtc:l||void 0}).subscribe({next:()=>{},error:()=>{}})}addItem(l){if(l.preventDefault(),!this.o)return;let e=this.o.id,d=(this.addProductId||"").trim(),r=Math.max(1,Number(this.addQty||1));d&&this.#e.addOrUpdateItem(e,d,r).subscribe({next:a=>{this.o=a,this.addProductId="",this.addQty=1},error:a=>alert(a?.error?.error||"No se pudo agregar")})}setQty(l,e){if(!this.o)return;let d=Math.max(0,Number(e||0));this.#e.setItemQty(this.o.id,l,d).subscribe({next:r=>this.o=r,error:r=>alert(r?.error?.error||"No se pudo actualizar")})}inc(l,e){this.setQty(l,Number(e||0)+1)}dec(l,e){this.setQty(l,Math.max(0,Number(e||0)-1))}remove(l){this.setQty(l,0)}deleteOrder(){this.o&&confirm("\xBFEliminar este pedido?")&&this.#e.delete(this.o.id).subscribe({next:()=>history.back(),error:l=>alert(l?.error?.error||"No se pudo eliminar")})}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=w({type:s,selectors:[["ng-component"]],decls:3,vars:2,consts:[["loading",""],["class","container my-4",4,"ngIf","ngIfElse"],[1,"container","my-4"],[1,"row","g-3"],[1,"col-12","col-lg-8"],[1,"card","p-3"],[1,"card-title"],[1,"table-responsive"],[1,"table","align-middle"],[2,"width","180px"],[4,"ngFor","ngForOf"],[1,"row","g-2",3,"submit"],[1,"col-12","col-md-7"],["placeholder","ProductId (GUID)","name","productId","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-6","col-md-3"],["type","number","name","qty","min","1","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-6","col-md-2","d-grid"],["type","submit",1,"btn","btn-outline-dark"],[1,"col-12","col-lg-4"],[1,"card","p-3","mb-3"],[1,"fw-semibold"],[1,"text-muted","small"],[1,"mt-2"],["class","text-success",4,"ngIf"],[1,"mb-1"],[1,"badge","text-bg-info","text-dark"],[1,"badge","text-bg-secondary"],["class","mb-1",4,"ngIf"],["class","card p-3 mb-3",4,"ngIf"],[1,"mb-2"],[1,"form-label"],[1,"form-select",3,"ngModelChange","ngModel"],[1,"d-grid","gap-2"],[1,"btn","btn-dark",3,"click"],[1,"btn","btn-outline-danger",3,"click"],[1,"card","p-3","mt-3"],["placeholder","DHL, FedEx, Estafeta",1,"form-control",3,"ngModelChange","ngModel"],["placeholder","C\xF3digo de rastreo",1,"form-control",3,"ngModelChange","ngModel"],["type","datetime-local",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-outline-dark",3,"click"],[1,"input-group","input-group-sm",2,"max-width","160px"],[1,"btn","btn-outline-secondary",3,"click"],["type","number",1,"form-control",3,"change","value"],[1,"text-end"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"text-success"],[4,"ngIf"]],template:function(e,d){if(e&1&&f(0,ie,115,27,"section",1)(1,ne,2,0,"ng-template",null,0,D),e&2){let r=P(2);_("ngIf",d.o)("ngIfElse",r)}},dependencies:[V,O,j,q,U,X,T,F,R,W,L,z,G,Q,B,k],encapsulation:2})};export{K as OrderAdminDetailPage};
