import{a as U}from"./chunk-YRIG7VKP.js";import{b as P,d as T}from"./chunk-O3H6VTXY.js";import{a as H,c as z}from"./chunk-2VES27NH.js";import{a as F}from"./chunk-SG536L4V.js";import{b as N,c as O,d as q,e as D,f as j,g as R,n as G,o as B,p as L}from"./chunk-S2MMUX5V.js";import"./chunk-CLVRU5UC.js";import{h as I}from"./chunk-FI2SLH6F.js";import{Ab as w,Da as s,Eb as v,Fb as y,Gb as S,Ma as h,Pb as k,Ra as x,W as g,aa as m,ba as u,cb as p,db as r,eb as o,fb as A,ib as M,jb as E,kb as b,nb as _,ob as d,vb as V,xb as C,yb as l,zb as W}from"./chunk-4XZ7JV2Z.js";function X(a,n){if(a&1&&(r(0,"div",13),l(1),o()),a&2){let e=d(2);s(),W(e.error)}}function Y(a,n){if(a&1){let e=b();M(0),r(1,"div",3)(2,"button",4),_("click",function(){m(e);let t=d();return u(t.mode="login")}),l(3,"Iniciar sesi\xF3n"),o(),r(4,"button",4),_("click",function(){m(e);let t=d();return u(t.mode="register")}),l(5,"Crear cuenta"),o()(),r(6,"form",5),_("submit",function(t){m(e);let c=d();return u(c.onSubmit(t))}),r(7,"input",6),S("ngModelChange",function(t){m(e);let c=d();return y(c.email,t)||(c.email=t),u(t)}),o(),r(8,"input",7),S("ngModelChange",function(t){m(e);let c=d();return y(c.password,t)||(c.password=t),u(t)}),o(),r(9,"button",8),l(10),o(),x(11,X,2,1,"div",9),o(),r(12,"div",10),l(13,"o"),o(),r(14,"div",11)(15,"button",12),_("click",function(){m(e);let t=d();return u(t.social("Google"))}),l(16,"Google"),o(),r(17,"button",12),_("click",function(){m(e);let t=d();return u(t.social("Facebook"))}),l(18,"Facebook"),o()(),E()}if(a&2){let e=d();s(2),C("active",e.mode==="login"),s(2),C("active",e.mode==="register"),s(3),v("ngModel",e.email),s(),v("ngModel",e.password),s(),p("disabled",e.loading),s(),w(" ",e.mode==="login"?"Entrar":"Registrarme"," "),s(),p("ngIf",e.error),s(4),p("disabled",e.loading),s(2),p("disabled",e.loading)}}function Z(a,n){if(a&1){let e=b();r(0,"div",14)(1,"div")(2,"div",15),l(3),o(),r(4,"small",16),l(5,"Sesi\xF3n iniciada"),o()(),r(6,"button",17),_("click",function(){m(e);let t=d();return u(t.logout())}),l(7,"Cerrar sesi\xF3n"),o()()}if(a&2){let e,i=d();s(3),w("Hola, ",(e=i.auth.user())==null?null:e.email),s(3),p("disabled",i.loading)}}var f=class a{auth=g(F);#e=g(U);#n=g(P);#a=g(T);#i=g(z);#s=g(H);mode="login";email="";password="";loading=!1;error="";returnUrl=null;ngOnInit(){this.#e.session().subscribe({error:()=>{}});let n=this.#n.snapshot.queryParamMap;n.get("login")==="1"&&(this.mode="login"),n.get("register")==="1"&&(this.mode="register"),this.returnUrl=n.get("returnUrl"),this.#n.queryParamMap.subscribe(e=>{e.get("login")==="1"&&(this.mode="login"),e.get("register")==="1"&&(this.mode="register"),this.returnUrl=e.get("returnUrl")})}onSubmit(n){n.preventDefault(),this.error="",this.loading=!0;let{email:e,password:i}=this,t=()=>this.loading=!1;this.mode==="login"?this.#e.login(e,i).subscribe({next:()=>this.#r(t),error:c=>{this.error=this.#t(c),t()}}):this.#e.register(e,i).subscribe({next:()=>this.#e.login(e,i).subscribe({next:()=>this.#r(t),error:c=>{this.error=this.#t(c),t()}}),error:c=>{this.error=this.#t(c),t()}})}logout(){this.loading=!0,this.#e.logout().subscribe({next:()=>this.loading=!1,error:()=>this.loading=!1})}#t(n){return n?.error?.errors?Object.values(n.error.errors).flat().join(" "):typeof n?.error=="string"?n.error:"Ocurri\xF3 un error. Verifica tus datos."}#r(n){let e=this.#i.items().map(i=>({productId:i.productId,qty:i.qty}));this.#s.merge(e).subscribe({next:i=>{this.#i.replaceFromServer(i.items.map(t=>({productId:t.productId,name:t.name,sku:t.sku,price:t.price,qty:t.qty}))),this.#o(n)},error:()=>this.#o(n)})}#o(n){n();let e=this.returnUrl&&this.returnUrl.startsWith("/")?this.returnUrl:"/perfil";this.#a.navigateByUrl(e)}social(n){let e=window.location.origin+(this.returnUrl||"/perfil");window.location.href=`/api/auth/external/${n}?returnUrl=${encodeURIComponent(e)}`}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=h({type:a,selectors:[["app-auth-widget"]],decls:4,vars:2,consts:[["logged",""],[1,"card","p-3"],[4,"ngIf","ngIfElse"],[1,"tabs","d-flex","gap-2","mb-2"],[3,"click"],[1,"d-grid","gap-2",3,"submit"],["type","email","placeholder","Email","name","email","required","",1,"form-control",3,"ngModelChange","ngModel"],["type","password","placeholder","Contrase\xF1a","name","password","minlength","6","required","",1,"form-control",3,"ngModelChange","ngModel"],["type","submit",1,"btn","btn-dark",3,"disabled"],["class","text-danger small",4,"ngIf"],[1,"text-center","my-2","text-muted"],[1,"d-flex","gap-2"],[1,"btn","btn-outline-dark","w-100",3,"click","disabled"],[1,"text-danger","small"],[1,"d-flex","justify-content-between","align-items-center"],[1,"fw-semibold"],[1,"text-muted"],[1,"btn","btn-outline-secondary",3,"click","disabled"]],template:function(e,i){if(e&1&&(r(0,"div",1),x(1,Y,19,11,"ng-container",2)(2,Z,8,2,"ng-template",null,0,k),o()),e&2){let t=V(3);s(),p("ngIf",!i.auth.isAuthenticated())("ngIfElse",t)}},dependencies:[L,R,N,O,q,G,B,j,D,I],styles:[".card[_ngcontent-%COMP%]{border-radius:.75rem;border:1px solid rgba(0,0,0,.08)}.tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;background:transparent;padding:.5rem 1rem;font-weight:600}.tabs[_ngcontent-%COMP%]   .active[_ngcontent-%COMP%]{color:var(--jdm-red);border-bottom:2px solid var(--jdm-red)}"]})};var J=class a{static \u0275fac=function(e){return new(e||a)};static \u0275cmp=h({type:a,selectors:[["ng-component"]],decls:10,vars:0,consts:[[1,"auth-hero","py-4","py-lg-5","border-bottom"],[1,"container"],[1,"h3","m-0"],[1,"text-muted","m-0"],[1,"container","my-4"],[1,"row","justify-content-center"],[1,"col-12","col-md-6","col-lg-5"]],template:function(e,i){e&1&&(r(0,"section",0)(1,"div",1)(2,"h1",2),l(3,"Tu cuenta"),o(),r(4,"p",3),l(5,"Inicia sesi\xF3n o crea una nueva cuenta."),o()()(),r(6,"section",4)(7,"div",5)(8,"div",6),A(9,"app-auth-widget"),o()()())},dependencies:[f],styles:[".auth-hero[_ngcontent-%COMP%]{background:linear-gradient(180deg,#f8f9fa,#fff)}"]})};export{J as AuthPage};
