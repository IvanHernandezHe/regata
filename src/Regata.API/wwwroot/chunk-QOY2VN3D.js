import{a as R}from"./chunk-Z2AK4YHA.js";import{e as F}from"./chunk-OGOOJ37H.js";import{a as q,b as X,c as Q}from"./chunk-LFHAJQI2.js";import{a as W}from"./chunk-YONKQZSU.js";import{b as A,c as B,f as O,p as $}from"./chunk-Z6ULA57Y.js";import{g as M,h as N,k as D}from"./chunk-FNKGIW6C.js";import{Ba as c,Cb as P,Db as T,Eb as V,Ib as b,Ka as k,Kb as h,Mb as y,Pa as _,W as x,aa as p,ab as d,ba as u,bb as i,cb as e,db as I,ib as C,lb as g,mb as m,tb as E,vb as w,wb as r,xb as v,yb as f}from"./chunk-7DVQ7J3I.js";function j(a,n){if(a&1){let t=C();i(0,"button",16),g("click",function(){p(t);let l=m();return u(l.removeCoupon())}),r(1,"Quitar"),e()}}function K(a,n){if(a&1&&(i(0,"div",17)(1,"small",18),r(2,"Cup\xF3n aplicado: "),i(3,"strong"),r(4),e()()()),a&2){let t=n.ngIf;c(4),v(t.code)}}function U(a,n){if(a&1&&(i(0,"small",18),r(1),e()),a&2){let t=m().$implicit;c(),f("Quedan ",t.stock)}}function G(a,n){if(a&1){let t=C();i(0,"tr")(1,"td"),r(2),i(3,"small",22),r(4),e(),_(5,U,2,1,"small",23),e(),i(6,"td")(7,"div",24)(8,"button",16),g("click",function(){let l=p(t).$implicit,s=m(2);return u(s.dec(l.productId))}),r(9,"\u2212"),e(),i(10,"button",25),r(11),e(),i(12,"button",26),g("click",function(){let l=p(t).$implicit,s=m(2);return u(s.inc(l.productId))}),r(13,"+"),e()()(),i(14,"td"),r(15),b(16,"currency"),e(),i(17,"td")(18,"button",27),g("click",function(){let l=p(t).$implicit,s=m(2);return u(s.remove(l.productId))}),r(19,"Quitar"),e()()()}if(a&2){let t=n.$implicit;c(2),f(" ",t.name," "),c(2),f("SKU ",t.sku),c(),d("ngIf",t.stock!==void 0),c(6),v(t.qty),c(),d("disabled",t.stock&&t.qty>=t.stock),c(3),v(h(16,6,t.price*t.qty,"MXN"))}}function z(a,n){if(a&1&&(i(0,"table",19)(1,"thead")(2,"tr")(3,"th"),r(4,"Producto"),e(),i(5,"th",20),r(6,"Cantidad"),e(),i(7,"th"),r(8,"Importe"),e(),I(9,"th"),e()(),i(10,"tbody"),_(11,G,20,9,"tr",21),e()()),a&2){let t=m();c(11),d("ngForOf",t.cart.items())}}function H(a,n){a&1&&(i(0,"div",28),r(1,"Tu carrito est\xE1 vac\xEDo."),e())}function J(a,n){if(a&1&&(i(0,"div",29),r(1),b(2,"currency"),e()),a&2){let t=m();c(),f("Descuento estimado: \u2212",h(2,1,t.cart.estimateDiscount(),"MXN"))}}function Y(a,n){if(a&1){let t=C();i(0,"tr")(1,"td"),r(2),i(3,"small",22),r(4),e()(),i(5,"td"),r(6),b(7,"currency"),e(),i(8,"td",34)(9,"button",35),g("click",function(){let l=p(t).$implicit,s=m(3);return u(s.moveSavedToCart(l))}),r(10,"Mover al carrito"),e(),i(11,"button",36),g("click",function(){let l=p(t).$implicit,s=m(3);return u(s.removeSaved(l))}),r(12,"Quitar"),e()()()}if(a&2){let t=n.$implicit;c(2),f("",t.productName," "),c(2),f("SKU ",t.productSku),c(2),v(h(7,3,t.price,"MXN"))}}function Z(a,n){if(a&1&&(i(0,"div")(1,"div",33)(2,"table",19)(3,"thead")(4,"tr")(5,"th"),r(6,"Producto"),e(),i(7,"th"),r(8,"Precio"),e(),I(9,"th"),e()(),i(10,"tbody"),_(11,Y,13,6,"tr",21),e()()()()),a&2){let t=m(2);c(11),d("ngForOf",t.saved)}}function tt(a,n){a&1&&(i(0,"div",18),r(1,"No hay art\xEDculos guardados."),e())}function et(a,n){if(a&1&&(i(0,"section",30)(1,"h3",31),r(2,"Guardados para despu\xE9s"),e(),_(3,Z,12,1,"div",32)(4,tt,2,0,"ng-template",null,1,y),e()),a&2){let t=E(5),o=m();c(3),d("ngIf",o.saved.length)("ngIfElse",t)}}var L=class a{cart=x(Q);auth=x(W);#t=x(R);#e=x(X);#i=x(q);coupon="";saved=[];remove(n){this.cart.remove(n)}inc(n){this.cart.increment(n)}dec(n){this.cart.decrement(n)}clearConfirm(){if(confirm("\xBFVaciar carrito? Esta acci\xF3n no se puede deshacer.")){let n=this.cart.items();this.cart.clear(),this.#e.showWithAction("Carrito vaciado","Deshacer",()=>this.restore(n))}}applyCoupon(){this.cart.applyCoupon(this.coupon)}removeCoupon(){this.cart.clearCoupon()}ngOnInit(){this.auth.isAuthenticated()&&this.loadSaved(),this.#i.get().subscribe({next:n=>{let t=this.cart.items();n.items?.length&&(t.length===0||this.cart.isServerSynced())&&this.cart.replaceFromServer(n.items.map(o=>({productId:o.productId,name:o.name,sku:o.sku,price:o.price,qty:o.qty,stock:o.stock})))},error:()=>{}})}loadSaved(){this.#t.list().subscribe({next:n=>this.saved=n,error:()=>this.saved=[]})}moveSavedToCart(n){this.#t.moveToCart(n.productId,1).subscribe({next:()=>{this.loadSaved(),this.cart.increment(n.productId,1)},error:()=>{}})}removeSaved(n){this.#t.remove(n.productId).subscribe({next:()=>this.loadSaved(),error:()=>{}})}restore(n){this.cart.restoreSnapshot(n)}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=k({type:a,selectors:[["ng-component"]],decls:31,vars:18,consts:[["empty",""],["noneSaved",""],[1,"container","my-4"],[1,"row","g-2","align-items-center","mb-3"],[1,"col-12","col-md-6","d-flex","gap-2"],["placeholder","Cup\xF3n de descuento","name","coupon",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-outline-dark",3,"click"],["class","btn btn-outline-secondary",3,"click",4,"ngIf"],["class","col-12 col-md-6 text-md-end",4,"ngIf"],["class","table align-middle",4,"ngIf","ngIfElse"],[1,"d-flex","justify-content-between","align-items-center","mt-3","gap-2"],["class","text-success",4,"ngIf"],[1,"d-flex","gap-2"],[1,"btn","btn-outline-danger",3,"click","disabled"],["routerLink","/checkout",1,"btn","btn-dark"],["class","container mb-5",4,"ngIf"],[1,"btn","btn-outline-secondary",3,"click"],[1,"col-12","col-md-6","text-md-end"],[1,"text-muted"],[1,"table","align-middle"],[2,"width","200px"],[4,"ngFor","ngForOf"],[1,"text-muted","d-block"],["class","text-muted",4,"ngIf"],["role","group","aria-label","cantidad",1,"btn-group"],["disabled","",1,"btn","btn-light"],[1,"btn","btn-outline-secondary",3,"click","disabled"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"alert","alert-info"],[1,"text-success"],[1,"container","mb-5"],[1,"h5"],[4,"ngIf","ngIfElse"],[1,"table-responsive"],[1,"text-nowrap"],[1,"btn","btn-sm","btn-outline-dark","me-1",3,"click"],[1,"btn","btn-sm","btn-outline-secondary",3,"click"]],template:function(t,o){if(t&1){let l=C();i(0,"section",2)(1,"h2"),r(2,"Carrito"),e(),i(3,"div",3)(4,"div",4)(5,"input",5),V("ngModelChange",function(S){return p(l),T(o.coupon,S)||(o.coupon=S),u(S)}),e(),i(6,"button",6),g("click",function(){return p(l),u(o.applyCoupon())}),r(7,"Aplicar"),e(),_(8,j,2,0,"button",7),e(),_(9,K,5,1,"div",8),e(),_(10,z,12,1,"table",9)(11,H,2,0,"ng-template",null,0,y),i(13,"div",10)(14,"div")(15,"div")(16,"strong"),r(17),b(18,"currency"),e()(),_(19,J,3,4,"div",11),i(20,"div"),r(21,"Total estimado: "),i(22,"strong"),r(23),b(24,"currency"),e()()(),i(25,"div",12)(26,"button",13),g("click",function(){return p(l),u(o.clearConfirm())}),r(27,"Vaciar"),e(),i(28,"a",14),r(29,"Ir a pagar"),e()()()(),_(30,et,6,2,"section",15)}if(t&2){let l=E(12);c(5),P("ngModel",o.coupon),c(3),d("ngIf",o.cart.coupon()),c(),d("ngIf",o.cart.coupon()),c(),d("ngIf",o.cart.items().length)("ngIfElse",l),c(7),f("Subtotal: ",h(18,12,o.cart.subtotal(),"MXN")),c(2),d("ngIf",o.cart.estimateDiscount()>0),c(4),v(h(24,15,o.cart.subtotal()-o.cart.estimateDiscount(),"MXN")),c(3),d("disabled",o.cart.items().length===0),c(2),w("disabled",o.cart.items().length===0),c(2),d("ngIf",o.auth.isAuthenticated())}},dependencies:[M,N,F,$,A,B,O,D],encapsulation:2})};export{L as CartPage};
