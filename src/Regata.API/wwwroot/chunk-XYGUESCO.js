import{a as R}from"./chunk-XWODR3QY.js";import{e as F}from"./chunk-EEXHPHRE.js";import{b as X,c as Q}from"./chunk-Z67MO5CF.js";import{a as W}from"./chunk-VERFBTRB.js";import{a as A,b as B,e as O,m as $}from"./chunk-CVTXNI7X.js";import{g as M,h as N,k as D}from"./chunk-DW6AFCKZ.js";import{$ as p,$a as d,Aa as o,Ab as P,Bb as T,Cb as V,Gb as v,Ib as b,Ja as k,Kb as y,Oa as _,V as h,aa as u,ab as i,bb as e,cb as E,hb as C,kb as g,lb as m,sb as I,ub as w,vb as n,wb as x,xb as f}from"./chunk-BIY3REYI.js";function L(r,a){if(r&1){let t=C();i(0,"button",16),g("click",function(){p(t);let l=m();return u(l.removeCoupon())}),n(1,"Quitar"),e()}}function j(r,a){if(r&1&&(i(0,"div",17)(1,"small",18),n(2,"Cup\xF3n aplicado: "),i(3,"strong"),n(4),e()()()),r&2){let t=a.ngIf;o(4),x(t.code)}}function K(r,a){if(r&1&&(i(0,"small",18),n(1),e()),r&2){let t=m().$implicit;o(),f("Quedan ",t.stock)}}function U(r,a){if(r&1){let t=C();i(0,"tr")(1,"td"),n(2),i(3,"small",22),n(4),e(),_(5,K,2,1,"small",23),e(),i(6,"td")(7,"div",24)(8,"button",16),g("click",function(){let l=p(t).$implicit,s=m(2);return u(s.dec(l.productId))}),n(9,"\u2212"),e(),i(10,"button",25),n(11),e(),i(12,"button",26),g("click",function(){let l=p(t).$implicit,s=m(2);return u(s.inc(l.productId))}),n(13,"+"),e()()(),i(14,"td"),n(15),v(16,"currency"),e(),i(17,"td")(18,"button",27),g("click",function(){let l=p(t).$implicit,s=m(2);return u(s.remove(l.productId))}),n(19,"Quitar"),e()()()}if(r&2){let t=a.$implicit;o(2),f(" ",t.name," "),o(2),f("SKU ",t.sku),o(),d("ngIf",t.stock!==void 0),o(6),x(t.qty),o(),d("disabled",t.stock&&t.qty>=t.stock),o(3),x(b(16,6,t.price*t.qty,"MXN"))}}function G(r,a){if(r&1&&(i(0,"table",19)(1,"thead")(2,"tr")(3,"th"),n(4,"Producto"),e(),i(5,"th",20),n(6,"Cantidad"),e(),i(7,"th"),n(8,"Importe"),e(),E(9,"th"),e()(),i(10,"tbody"),_(11,U,20,9,"tr",21),e()()),r&2){let t=m();o(11),d("ngForOf",t.cart.items())}}function z(r,a){r&1&&(i(0,"div",28),n(1,"Tu carrito est\xE1 vac\xEDo."),e())}function H(r,a){if(r&1&&(i(0,"div",29),n(1),v(2,"currency"),e()),r&2){let t=m();o(),f("Descuento estimado: \u2212",b(2,1,t.cart.estimateDiscount(),"MXN"))}}function J(r,a){if(r&1){let t=C();i(0,"tr")(1,"td"),n(2),i(3,"small",22),n(4),e()(),i(5,"td"),n(6),v(7,"currency"),e(),i(8,"td",34)(9,"button",35),g("click",function(){let l=p(t).$implicit,s=m(3);return u(s.moveSavedToCart(l))}),n(10,"Mover al carrito"),e(),i(11,"button",36),g("click",function(){let l=p(t).$implicit,s=m(3);return u(s.removeSaved(l))}),n(12,"Quitar"),e()()()}if(r&2){let t=a.$implicit;o(2),f("",t.productName," "),o(2),f("SKU ",t.productSku),o(2),x(b(7,3,t.price,"MXN"))}}function Y(r,a){if(r&1&&(i(0,"div")(1,"div",33)(2,"table",19)(3,"thead")(4,"tr")(5,"th"),n(6,"Producto"),e(),i(7,"th"),n(8,"Precio"),e(),E(9,"th"),e()(),i(10,"tbody"),_(11,J,13,6,"tr",21),e()()()()),r&2){let t=m(2);o(11),d("ngForOf",t.saved)}}function Z(r,a){r&1&&(i(0,"div",18),n(1,"No hay art\xEDculos guardados."),e())}function tt(r,a){if(r&1&&(i(0,"section",30)(1,"h3",31),n(2,"Guardados para despu\xE9s"),e(),_(3,Y,12,1,"div",32)(4,Z,2,0,"ng-template",null,1,y),e()),r&2){let t=I(5),c=m();o(3),d("ngIf",c.saved.length)("ngIfElse",t)}}var q=class r{cart=h(Q);auth=h(W);#t=h(R);#e=h(X);coupon="";saved=[];remove(a){this.cart.remove(a)}inc(a){this.cart.increment(a)}dec(a){this.cart.decrement(a)}clearConfirm(){if(confirm("\xBFVaciar carrito? Esta acci\xF3n no se puede deshacer.")){let a=this.cart.items();this.cart.clear(),this.#e.showWithAction("Carrito vaciado","Deshacer",()=>this.restore(a))}}applyCoupon(){this.cart.applyCoupon(this.coupon)}removeCoupon(){this.cart.clearCoupon()}ngOnInit(){this.auth.isAuthenticated()&&this.loadSaved()}loadSaved(){this.#t.list().subscribe({next:a=>this.saved=a,error:()=>this.saved=[]})}moveSavedToCart(a){this.#t.moveToCart(a.productId,1).subscribe({next:()=>{this.loadSaved(),this.cart.increment(a.productId,1)},error:()=>{}})}removeSaved(a){this.#t.remove(a.productId).subscribe({next:()=>this.loadSaved(),error:()=>{}})}restore(a){this.cart.restoreSnapshot(a)}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=k({type:r,selectors:[["ng-component"]],decls:31,vars:18,consts:[["empty",""],["noneSaved",""],[1,"container","my-4"],[1,"row","g-2","align-items-center","mb-3"],[1,"col-12","col-md-6","d-flex","gap-2"],["placeholder","Cup\xF3n de descuento","name","coupon",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-outline-dark",3,"click"],["class","btn btn-outline-secondary",3,"click",4,"ngIf"],["class","col-12 col-md-6 text-md-end",4,"ngIf"],["class","table align-middle",4,"ngIf","ngIfElse"],[1,"d-flex","justify-content-between","align-items-center","mt-3","gap-2"],["class","text-success",4,"ngIf"],[1,"d-flex","gap-2"],[1,"btn","btn-outline-danger",3,"click","disabled"],["routerLink","/checkout",1,"btn","btn-dark"],["class","container mb-5",4,"ngIf"],[1,"btn","btn-outline-secondary",3,"click"],[1,"col-12","col-md-6","text-md-end"],[1,"text-muted"],[1,"table","align-middle"],[2,"width","200px"],[4,"ngFor","ngForOf"],[1,"text-muted","d-block"],["class","text-muted",4,"ngIf"],["role","group","aria-label","cantidad",1,"btn-group"],["disabled","",1,"btn","btn-light"],[1,"btn","btn-outline-secondary",3,"click","disabled"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"alert","alert-info"],[1,"text-success"],[1,"container","mb-5"],[1,"h5"],[4,"ngIf","ngIfElse"],[1,"table-responsive"],[1,"text-nowrap"],[1,"btn","btn-sm","btn-outline-dark","me-1",3,"click"],[1,"btn","btn-sm","btn-outline-secondary",3,"click"]],template:function(t,c){if(t&1){let l=C();i(0,"section",2)(1,"h2"),n(2,"Carrito"),e(),i(3,"div",3)(4,"div",4)(5,"input",5),V("ngModelChange",function(S){return p(l),T(c.coupon,S)||(c.coupon=S),u(S)}),e(),i(6,"button",6),g("click",function(){return p(l),u(c.applyCoupon())}),n(7,"Aplicar"),e(),_(8,L,2,0,"button",7),e(),_(9,j,5,1,"div",8),e(),_(10,G,12,1,"table",9)(11,z,2,0,"ng-template",null,0,y),i(13,"div",10)(14,"div")(15,"div")(16,"strong"),n(17),v(18,"currency"),e()(),_(19,H,3,4,"div",11),i(20,"div"),n(21,"Total estimado: "),i(22,"strong"),n(23),v(24,"currency"),e()()(),i(25,"div",12)(26,"button",13),g("click",function(){return p(l),u(c.clearConfirm())}),n(27,"Vaciar"),e(),i(28,"a",14),n(29,"Ir a pagar"),e()()()(),_(30,tt,6,2,"section",15)}if(t&2){let l=I(12);o(5),P("ngModel",c.coupon),o(3),d("ngIf",c.cart.coupon()),o(),d("ngIf",c.cart.coupon()),o(),d("ngIf",c.cart.items().length)("ngIfElse",l),o(7),f("Subtotal: ",b(18,12,c.cart.subtotal(),"MXN")),o(2),d("ngIf",c.cart.estimateDiscount()>0),o(4),x(b(24,15,c.cart.subtotal()-c.cart.estimateDiscount(),"MXN")),o(3),d("disabled",c.cart.items().length===0),o(2),w("disabled",c.cart.items().length===0),o(2),d("ngIf",c.auth.isAuthenticated())}},dependencies:[M,N,F,$,A,B,O,D],encapsulation:2})};export{q as CartPage};
